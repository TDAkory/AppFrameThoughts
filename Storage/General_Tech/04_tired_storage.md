# 分层存储

## Why we need

传统存储节点依赖本地磁盘，存在以下问题：

- 流量波动和存储固定容量冲突
- 数据保留时长受限于集群资源
- 存储介质成本和需求不匹配
- 存储和计算耦合，扩缩容效率低
- 冷数据操作容易影响集群性能

针对问题，需要低成本高灵活度的弹性存储方案，核心能力如下：

- 低成本存储适配
- 无感弹性扩缩容
- 数据生命周期自治
- 精细化配置管理

## 选型

实例型产品(中间件、数据库、NoSql)当前大部分采用 shared-nothing 架构：单节点独立使用自己的块存储，不同节点之间无任何数据共享。块设备在云上主要表现为云盘或本地物理盘，由于块设备在缩容、多挂载、单节点容量和成本方面存在限制，所以弹性存储的能力不适合在块设备中继续扩展实现。

价格低廉、易于扩展且支持数据共享的池化存储，如分布式文件存储（HDFS）以及对象存储（S3），成为实现弹性能力的首选存储介质。

数据如何写入弹性存储通常存在两种方式

```c
                        Direct Write
    Broker          ------------------>  Remote Storage

                
    Broker              Async Write
      |             ------------------>  Remote Storage
   Cloud Disk
  (Compaction)
```
