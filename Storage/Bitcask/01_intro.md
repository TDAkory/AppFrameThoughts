# Bitcask

A Log-Structured Hash Table for Fast Key/Value Data

-[Bitcask - A Log-Structured Hash Table](https://tech-lessons.in/en/blog/bitcask/)

应用场景：

- 读写低延迟
- 高吞吐，特别是对大量的随机写入
- 能够处理超过内存容量的数据
- 崩溃恢复友好，能够保证快速恢复，尽量不丢数据
- 简单的备份和恢复策略
- value的大小远大于key，但是value不能太大

Bitcask是一种基于文件系统的存储结构，具有独特的文件组织和数据存储格式。

1. **整体目录结构**：一个Bitcask实例对应一个目录，同一时刻仅允许一个进程操作该目录，此进程可视为数据库服务器。目录中包含一个活跃文件和多个旧数据文件。
2. **活跃文件与旧数据文件**
    - **活跃文件**：同一时刻只有一个活跃文件用于服务器写入。当活跃文件大小达到指定阈值时，会被关闭，同时创建新的活跃文件。
    - **旧数据文件**：文件因写满或服务器（进程）退出而关闭后，就成为旧数据文件。旧数据文件不可变，不再进行写操作。
3. **数据存储格式**：写入磁盘文件的数据有固定格式，包含以下字段：
    - **crc**：用于数据校验，可防止数据被破坏或篡改。
    - **tstamp**：记录写入数据的时间戳。
    - **ksz**：表示key的大小。
    - **value_sz**：表示value的大小。
    - **key**：用户实际存储的key。
    - **value**：用户实际存储的value。 