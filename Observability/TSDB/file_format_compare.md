在时序数据库领域，主流的文件存储格式可分为三类：**专为时序设计的自有格式**、**基于成熟存储引擎的扩展**以及**面向监控的块存储格式**。它们的设计目标各不相同，核心区别如下表所示：

| 特性维度 | **InfluxDB TSM** | **Apache IoTDB TsFile** | **TimescaleDB (基于PostgreSQL)** | **Prometheus TSDB** |
| :--- | :--- | :--- | :--- | :--- |
| **核心架构** | 基于LSM树的列式存储 | 列式存储，类LSM树结构 | 基于PostgreSQL的行/列混合存储 | 自定义的本地块存储 |
| **存储模型** | 按Series组织，索引与数据一体 | 按“设备-测点”树形结构组织 | 时序超表，自动按时间分区 | 按时间窗口（2小时）分块 |
| **写入优化** | 高吞吐追加写入 | 高并发写入，支持批处理 | 兼容PostgreSQL事务写入 | 内存映射写入WAL |
| **压缩特性** | 对时间戳、数值类型分别编码压缩 | 时序专用编码（TS_2DIFF， GORILLA） | 增量、游程、简单-8b、XOR等组合算法 | 通用压缩（如Snappy） |
| **查询特点** | 依赖内存索引，点查快 | 支持谓词下推与按需读取 | 支持完整SQL，复杂分析强 | 范围扫描高效，适合聚合 |
| **设计重心** | 写入吞吐与高压缩 | 工业物联网场景，端云一体 | SQL兼容性与生态集成 | 简单可靠，资源消耗低 |

### 📁 各格式详细分析
1.  **InfluxDB TSM：写入与压缩的典范**
    *   **架构**：TSM（Time Structured Merge tree）是LSM树在时序领域的变种。数据先写入内存和WAL，再刷盘为只读的TSM文件。TSM文件由Header、数据Block、索引区和Footer组成，其索引在内存中构建以便快速定位。
    *   **特点**：极高写入吞吐，利用时序数据（如时间戳）的特点进行高效压缩。其设计围绕InfluxDB的数据模型（Measurement, Series, Point），适合**大规模指标监控**场景。

2.  **Apache IoTDB TsFile：专为物联网设计的列式格式**
    *   **架构**：完全为时序设计的列式文件格式，采用多级映射结构（TsFileMetaData -> TimeSeriesMetadata -> ChunkMetadata -> Chunk）。数据按设备组织，同一设备的多测点数据可打包写入。
    *   **特点**：其核心是“端云一体”，边缘生成的TsFile可直接被云端读取。针对工业传感器数据定制了高效编码（如GORILLA压缩浮点数），并支持强大的查询过滤下推，是**工业物联网**的理想选择。

3.  **TimescaleDB：PostgreSQL生态的时序扩展**
    *   **架构**：本质是PostgreSQL的扩展，通过“时序超表”自动管理按时间的分区，数据最终存储在PostgreSQL的底层页中。
    *   **特点**：其强大之处在于**压缩算法组合**和完整的SQL支持。它组合使用增量编码、简单-8b、游程编码和基于XOR的浮点压缩，针对不同类型数据实现超高压缩比。适合需要**复杂分析、事务支持或已基于PostgreSQL**的场景。

4.  **Prometheus TSDB：监控场景的简约设计**
    *   **架构**：按固定时间窗口（默认为2小时）将数据切分为“块”，每个块包含索引、数据块（chunks）和墓碑文件。最新数据在内存中，通过WAL保证持久性。
    *   **特点**：设计极简，为单机部署和 PromQL 查询模型高度优化。查询时通过索引定位到块，再读取相关数据。适合**监控指标收集与告警**，但在大规模数据持久化和复杂查询上非其所长。

### 💎 总结与选型建议
*   **追求极致写入性能与压缩**：在纯时序场景下，**InfluxDB TSM** 或 **IoTDB TsFile** 是首选。
*   **需要复杂分析与SQL生态**：如果你的查询涉及多表关联、复杂聚合，或团队熟悉SQL，**TimescaleDB** 是最佳选择。
*   **专注监控与云原生集成**：**Prometheus TSDB** 是监控领域的事实标准，生态工具丰富。
*   **工业物联网与边缘计算**：**IoTDB TsFile** 的端云一体和工业优化特性使其在该领域独具优势。
