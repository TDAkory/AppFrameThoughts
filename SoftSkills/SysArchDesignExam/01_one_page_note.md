# One page note for system architecture designer

## 绪论

1. **架构**：架构是系统中组件的基本组织方式，涵盖了组件之间的关系、与环境的关系，以及指导系统设计和发展的原则。
2. **系统**：系统是由组件组成的集合，用于完成特定的功能。它可以是一个单独的应用程序、一个完整的系统、子系统、系统之系统、产品线、整个企业或任何其他感兴趣的集合。
3. **环境**：环境或上下文决定了系统的开发、运行、政策以及对其产生影响的外部条件和设置。
4. **任务**：任务是由一个或多个利益相关者通过系统来实现特定目标的操作或用途。

系统架构（System Architecture）

- 系统架构是系统整体高层次的结构表示。
- 它是系统的骨架和根基，支撑和链接各个部分，包括组件、连接件、约束规范以及指导这些内容设计与演化的原理。
- 系统架构是刻画系统整体抽象结构的一种手段。
- 架构设计的目的是对系统进行一系列相关的抽象，以指导系统的设计与实现。
- 架构设计在系统开发过程中起着关键作用，决定了系统的健壮性和生命周期的长短。

架构设计的作用：

1. 解决复杂的需求分析问题。
2. 解决**非功能属性**在系统设计中的重要问题。
3. 解决生命周期长、扩展性要求高的系统整体结构问题。
4. 解决系统基于组件的集成问题。
5. 解决业务流程再造的问题。

软件架构发展阶段

基础研究阶段（**模块化开发方法**：高内聚、低耦合、模块大小适度、接口简单）----> 概念体系和核心技术形成（**组件化技术**： 可组装性和可插拔性、组件化比模块化更独立、比应用集成结合的更加紧密）----> 理论体系完善与发展（软件架构描述与表示、软件架构分析、设计与测试；软件架构发现、演化与重用；软件架构开发方法；软件架构风格；动态软件架构）----> 普及应用阶段（**软件架构是软件生命周期的重要产物**，影响各个阶段）

软件架构的常用分类和建模方法

1. 分层架构：TCP-IP协议栈、表现层-业务层-持久层-数据库
2. 事件驱动架构：事件进行通信，分布式异步架构模式，适用于松散耦合系统。事件队列->分发器->事件通道->事件处理器
3. 微核架构：插件架构，Core只包含系统运行的最小功能，插件则互相独立来实现具体业务逻辑
4. 微服务架构：每一个服务就是一个独立的部署单元。RESTful API模式、RESTful应用模式、消息集中模式（Message Broker）
5. 云架构：基于云平台的架构，将应用程序和数据部署在云平台上，实现弹性扩展、高可用、高可靠、高安全。（处理单元、虚拟中间件）

**软件架构的模型**：这4种模型并非完全独立，要结合不同模型才能准确、全面地反映软件架构。

1. **结构模型**：是<span style="color: yellow;">最直观、普遍的</span>建模方法，通过架构的*构件、连接件和其他概念*刻画结构，力求反映系统的配置、约束、隐含假设条件、风格和性质等重要语义内容，研究其的核心是*架构描述语言*。
2. **框架模型**：和结构模型类似，但不太侧重描述结构细节，更侧重整体结构，主要以一些特殊问题为目标建立只针对和适应问题的结构。
3. **动态模型**：是对结构或框架模型的补充，主要研究*系统“大颗粒”行为的性质*，比如描述系统的重新配置或演化，这里的动态可指系统总体结构的配置、建立或拆除通信或计算的过程，这类系统模型常是激励型的。
4. **过程模型**：研究构造系统的<span style="color: yellow;">步骤和过程</span>，其结构是遵循某些过程脚本的结果。

软件架构应用场景及未来发展

| 架构风格                          | 适用场景                                             |
| --------------------------------- | ---------------------------------------------------- |
| 管道/过滤器风格                   | 用于将系统分成若干独立的步骤                         |
| 主程序/子系统和面向对象的架构风格 | 用于对组件内部进行设计                               |
| 虚拟机风格                        | 用于构造解释器或专家系统                             |
| C/S 和 B/S 风格                   | 适合于数据和处理分布在一定范围，通过网络连接构成系统 |
| 平台/插件风格                     | 用于具有插件扩展功能的应用程序                       |
| MVC 风格                          | 用于用户交互程序的设计                               |
| SOA 风格                          | 用在企业集成等方面                                   |
| C2 风格                           | 用于 GUI 软件开发，用以构建灵活和可扩展的应用系统等  |

架构发展主线可归纳为模块化编程、面向对象编程、构件技术、面向服务开发技术和云技术。

## 计算机基础知识

### 计算机系统概述——关键部件介绍

#### 处理器（CPU）

- **核心地位**：是计算机系统运算与控制的核心部件。
- **指令集分类**
  - **复杂指令集（CISC）**：以Intel、AMD的x86CPU为代表。
  - **精简指令集（RISC）**：以ARM和Power为代表。
- **其他相关处理器**
  - **图形处理器（GPU）**：属于特殊类型处理器，拥有数百或数千个内核，经优化可并行运行大量计算，在深度学习和机器学习领域应用广泛。
  - **信号处理器（DSP）**：专门用于实时的数字信号处理。
  - **现场可编程逻辑门阵（FPGA）**：也属于处理器相关范畴。

#### 存储器

- **基本定义**：利用半导体、磁、光等介质制成的电子设备，用于存储数据。
- **按硬件结构分类**：可分为SRAM、DRAM、NVRAM、Flash、EPROM、Disk等。
- **存储体系结构（按与处理器物理距离分）**
  - **片上缓存**：在处理器核心中直接集成的缓存，采用SRAM结构，容量小，速度快。
  - **片外缓存**：在处理器核心外的缓存，需经交换互联开关访问，由SRAM构成，容量较片上缓存略大，可称为L2Cache、L3Cache或平台Cache（Platform Cache）。
  - **主存（内存）**：采用DRAM结构，以独立的部件/芯片存在，通过总线与处理器连接。
  - **外存**：如硬盘、光盘等设备，这类设备访问速度慢，但容量大，且掉电后能保持数据。

#### 总线

- **定义**：计算机部件间遵循特定协议，以特定格式和控制逻辑实现数据交换与传输的形式。
- **分类（按在计算机中的位置）**
  - **内总线**：用于各类芯片内部互连，也可称为片上总线（On - Chip Bus）或片内总线。
  - **系统总线**：计算机中CPU、主存、I/O接口的总线。
  - **外部总线**：计算机板与外部设备之间，或计算机系统之间互联的总线，又称通信总线。
- **性能指标**：常见的有总线带宽、总线服务质量QoS、总线时延和总线抖动等。
- **类型**
  - **并行总线**：主要包括PCI、PCIe、ATA（IDE）等。
  - **串行总线**：主要包括USB、SATA、CAN、RS - 232、RS - 485、RapidIO和以太网等。

#### 接口

- **定义**：同一计算机不同功能层之间的通信规则。
- **常见类型**：显示类接口（HDMI、DVI等）、音频输入输出类接口（TRS、RCA、XLR等）、网络类接口（RJ45、FC等）、PS/2接口、USB接口、SATA接口、LPT（打印接口）、RS - 232接口等。

#### 外部设备

- **常规设备**：键盘、鼠标、显示器、扫描仪、摄像头、麦克风、打印机、光驱、各型网卡、各型存储卡/盘等。
- **移动与穿戴设备**：加速计、GPS、陀螺仪、感光设备、指纹识别设备等。
- **工业等特殊领域设备**：测温仪、测速仪、轨迹球、各型操作面板、红外/NIFC等感应设备、各种场强测量设备、功率驱动装置、各型机械臂、各型液压装置、压装装置等。

### 计算机软件

软件系统是在计算机硬件系统上运行的**程序、相关文档资料和数据的集合**，作用是扩充计算机系统功能、提高系统效率。

计算机软件通常分为**系统软件**和**应用软件**两大类。

#### 操作系统

**操作系统组成**：由操作系统内核（Kernel）和诸多附加配套软件组成，附加软件包括图形用户界面程序、常用应用程序以及支持应用软件开发和运行的各种软件构件（如应用框架、编译器、程序库等）。其中，操作系统内核是能提供进程管理（任务管理）、存储管理、文件管理和设备管理等功能的软件模块，是操作系统最基本部分，驻留内存，以CPU最高优先级运行，可执行特权指令，能直接访问外设和全部主存空间，负责系统资源管理与分配。

**操作系统的作用**：管理计算机中运行的程序并分配各种软硬件资源；为用户提供友善的人机界面；为应用程序的开发和运行提供高效率平台。此外，还具有辅导用户操作（帮助功能）、处理软硬件错误、监控系统性能、保护系统安全等作用。

**操作系统的特征**:

- **并发性**：多道程序环境下，一段时间内宏观上多个程序同时运行，但单CPU环境下，每一时刻只有一个程序在执行。
- **共享性**：操作系统中的资源被多个并发执行的进程共同使用，而非被一个进程独占。
- **虚拟性**：把一个物理实体变成逻辑上的多个对应物，或把物理上的多个实体变成逻辑上的一个对应物的技术。
- **不确定性**：多道程序环境中，进程走走停停，执行并非一贯到底。

**操作系统的分类**：

- **批处理操作系统**：分为单道批处理和多道批处理。单道批处理是用户可向系统提交多个作业，但一次只有一个作业装入内存执行，一个结束后另一个开始；多道批处理操作系统允许一次多个作业装入内存执行，任意时刻作业都处于开始点和终止点之间，具有多道、宏观上并行运行和微观上串行运行的特点。
- **分时操作系统**：将CPU的工作时间划分为很多很短的时间片，轮流为各个终端的用户服务，具有**多路性、独立性、交互性和及时性**的特点。
- **实时操作系统**：包含实时控制系统和实时信息系统，能对输入的信息快速处理，并在**被控对象允许的时间范围内做出快速反应**，对可靠性有保障要求。
- **网络操作系统**：是方便且有效地共享网络资源，为网络用户提供各种服务的软件和有关协议的集合。其特征包括**硬件独立性**（可运行在不同网络硬件上，能通过网桥或路由器与其他网络连接）和**多用户支持**（能同时支持多个用户对网络的访问，对信息资源提供完全的安全和保护功能）等。
- **分布式操作系统**：由多个分散的计算机经连接而成的计算机系统，系统中的计算机无主、次之分，任意两台计算机可通过通信交换信息。它是网络操作系统的更高级形式，保持网络系统全部功能的同时，还具有透明性、可靠性和高性能等特性。
- **微型计算机操作系统**：简称微机操作系统，常用的有Windows、Mac OS、Linux。
- **嵌入式操作系统**：运行在嵌入式智能设备环境中。对整个智能硬件以及它所操作、控制的各种部件装置等资源进行统一协调、处理、指挥和控制。
  - **微型化**：从性能和成本角度考虑，希望占用的资源和系统代码量少，如内存少、字长短、运行速度有限、能源少（用微小型电池）。
  - **可定制**：从减少成本和缩短研发周期考虑，能运行在不同的微处理器平台上，能**针对硬件变化进行结构与功能上的配置**，以满足不同应用需要。
  - **实时性**：主要应用于过程控制、数据采集、传输通信、多媒体信息及关键要害领域需要**迅速响应**的场合，对实时性要求较高。
  - **可靠性**：系统构件、模块和体系结构必须达到应有的可靠性，对关键要害应用还要提供容错和防故障措施。
  - **易移植性**：为提高易移植性，通常采用硬件抽象层（Hardware Abstraction Level，HAL）和板级支撑包（Board Support Package，BSP）的底层设计技术。

#### 数据库

数据库（DataBase，DB）定义：是长期存储在计算机内、有组织的、统一管理的相关数据的集合。

- **按存储体系分类**
  - **关系型数据库**：以二维表形式存储数据。
  - **键值（Key - Value）数据库**：将数据存储为键值对集合，键作为唯一标识符。
  - **列存储数据库**：表中数据的存储形式为列。
  - **文档数据库**：可存放并获取文档，支持XML、JSON、BSON等格式。
  - **搜索引擎数据库**：应用在搜索引擎领域的数据存储形式，因搜索引擎会爬取大量数据并以特定格式存储，能保证检索性能最优。

**文件（File）**：是具有符号名的、在逻辑上具有完整意义的一组相关信息项的集合。

**文件系统**：是操作系统中实现文件统一管理的一组软件和相关数据的集合，专门负责管理和存取文件信息。

**文件的结构和组织**

- **文件的逻辑结构**：指文件的组织形式，是从用户角度看到的文件组织形式。用户只需知道文件名就能存取文件信息，无需知道文件的存储位置。分为有结的记录式文件（由一个以上的记录构成）和无结构的流式文件（由一串顺序字符流构成）。
- **文件的物理结构**：从实现的角度看，文件在文件存储器上的存放方式。
  - **连续结构（顺序结构）**：将逻辑上连续的文件信息（如记录）依次存放在连续编号的物理块上。只要知道文件的起始物理块号和文件的长度，就可方便地进行文件的存取。
  - **链接结构（串联结构）**：把逻辑上连续的文件信息（如记录）存放在不连续的物理块上，每个物理块设有一个指针指向下一个物理块。只要知道文件的第1个物理块号，就可按链指针查找整个文件。
  - **索引结构**：将逻辑上连续的文件信息（如记录）存放在不连续的物理块中，系统为每个文件建立一张索引表，索引表记录了文件信息所在的逻辑块号对应的物理块号，并将索引表的起始地址放在与文件对应的文件目录项中。
  - **多个物理块的索引表**：索引表在文件创建时由系统自动建立，与文件一起存放在同一文件卷上。根据文件大小不同，索引表占用物理块的个数不等，一般占一个或几个物理块。多个物理块的索引表有链接文件和多重索引方式两种组织方式。

**索引分配可增加文件存储容量，包括单级索引、多级索引和混合索引。**

| 索引类型     | 指向内容说明                                                                                                 |
| ------------ | ------------------------------------------------------------------------------------------------------------ |
| 直接索引     | 直接指向存储文件数据的物理盘块（可快速定位小文件数据块）                                                     |
| 一级间接索引 | 指向一个“间接索引块”，该块中存储**多个直接指向数据物理盘块的地址**                                           |
| 二级间接索引 | 指向一个“二级间接索引块”，该块中存储**多个一级间接索引块的地址**；每个一级间接索引块再指向多个数据盘块地址   |
| 三级间接索引 | 指向一个“三级间接索引块”，该块中存储**多个二级间接索引块的地址**；二级间接索引块→一级间接索引块→数据盘块地址 |

**文件的存取方法**：是指读/写文件存储器上一个物理块的方法，通常有顺序存取和随机存取两种。顺序存取是按文件中信息的顺序依次进行读/写；随机存取是对文件中的信息按任意次序随机地读/写。

**文件存储空间的管理**：常用的空闲空间管理方法有空闲区表、位示图和空闲块链3种。
  - **空闲区表**：将外存空间上一个连续的未分配区域称为“空闲区”，适用于连续文件结构。
  - **位示图**：在外存上建立一张位示图（Bitmap），记录文件存储器的使用情况，每一位对应文件存储器上的一个物理块，取值0和1分别表示空闲和占用。
  - **空闲块链**：每个空闲物理块中有指向下一个空闲物理块的指针，所有空闲物理块构成一个链表，链表头指针放在文件存储器特定位置（如管理块），无需磁盘分配表，节省空间。申请空闲物理块时，根据链表头指针取出第一个空闲物理块，再依指针找后续空闲物理块。
  - **成组链接法**：UNIX系统采用的方法，将空闲块分成若干组，每100个空闲块为一组，每组第1个空闲块登记下一组空闲块的物理盘块号和空闲块总数，若某组第1个空闲块号为0，表明是最后一组，无下一组空闲块。

**文件共享**：不同用户进程使用同一文件，不仅是不同用户完成同一任务的必要功能，还能节省主存空间，减少因文件复制增加的访问外存次数。
  - **硬链接**：两个文件目录表目指向同一个索引结点的链接，也称基于**索引结点**的链接，即不同文件名与同一个文件实体的链接。
  - **符号链接**：建立新的文件或目录，与原来文件或目录的路径名进行映射，访问符号链接时，系统通过该**映射**找到原文件路径并访问。

**文件的保护方式**，常采用存取控制的方式，规定不同用户对文件的访问有不同权限，防止文件被未经同意的用户访问，具体方法有：
- **存取控制矩阵**：按个人划分权限，但规模太大。
- **存取控制表**：按用户分类做权限控制。
- **用户权限表**：以用户或用户组为单位，将用户可存取的文件集中存入表中，是对存取控制矩阵的改进。
- **密码**：创建文件时用户提供密码，文件存入磁盘时用该密码对内容加密。

// 9.中间件